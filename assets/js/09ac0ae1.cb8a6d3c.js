"use strict";(self.webpackChunk_playcanvas_blog=self.webpackChunk_playcanvas_blog||[]).push([[64629],{14744:e=>{var n=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var n=Object.prototype.toString.call(e);return"[object RegExp]"===n||"[object Date]"===n||function(e){return e.$$typeof===a}(e)}(e)};var a="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function t(e,n){return!1!==n.clone&&n.isMergeableObject(e)?s((a=e,Array.isArray(a)?[]:{}),e,n):e;var a}function r(e,n,a){return e.concat(n).map(function(e){return t(e,a)})}function i(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(n){return Object.propertyIsEnumerable.call(e,n)}):[]}(e))}function o(e,n){try{return n in e}catch(a){return!1}}function l(e,n,a){var r={};return a.isMergeableObject(e)&&i(e).forEach(function(n){r[n]=t(e[n],a)}),i(n).forEach(function(i){(function(e,n){return o(e,n)&&!(Object.hasOwnProperty.call(e,n)&&Object.propertyIsEnumerable.call(e,n))})(e,i)||(o(e,i)&&a.isMergeableObject(n[i])?r[i]=function(e,n){if(!n.customMerge)return s;var a=n.customMerge(e);return"function"==typeof a?a:s}(i,a)(e[i],n[i],a):r[i]=t(n[i],a))}),r}function s(e,a,i){(i=i||{}).arrayMerge=i.arrayMerge||r,i.isMergeableObject=i.isMergeableObject||n,i.cloneUnlessOtherwiseSpecified=t;var o=Array.isArray(a);return o===Array.isArray(e)?o?i.arrayMerge(e,a,i):l(e,a,i):t(a,i)}s.all=function(e,n){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,a){return s(e,a,n)},{})};var c=s;e.exports=c},20652:e=>{e.exports=JSON.parse('{"permalink":"/anim-layer-masks-and-blending","editUrl":"https://github.com/playcanvas/blog/tree/main/blog/2021-11-08-anim-layer-masks-and-blending.md","source":"@site/blog/2021-11-08-anim-layer-masks-and-blending.md","title":"Anim Layer Masks and Blending","description":"RUN DEMO","date":"2021-11-08T00:00:00.000Z","tags":[{"inline":true,"label":"animation","permalink":"/tags/animation"},{"inline":true,"label":"editor","permalink":"/tags/editor"},{"inline":true,"label":"workflow","permalink":"/tags/workflow"}],"readingTime":3.6,"hasTruncateMarker":true,"authors":[{"name":"Elliott Thompson","title":"Software Engineer","page":{"permalink":"/authors/elliott"},"socials":{"x":"https://x.com/elliott_thomps","linkedin":"https://www.linkedin.com/in/ellt92/","github":"https://github.com/ellthompson"},"imageURL":"https://github.com/ellthompson.png","key":"elliott"}],"frontMatter":{"authors":"elliott","slug":"anim-layer-masks-and-blending","title":"Anim Layer Masks and Blending","tags":["animation","editor","workflow"]},"unlisted":false,"prevItem":{"title":"Editor API Beta Release","permalink":"/editor-api-beta-release"},"nextItem":{"title":"Changes to our Editor and Engine Releases","permalink":"/changes-to-our-editor-and-engine-releases"}}')},28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>l});var t=a(96540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}},36437:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>m});var t=a(20652),r=a(74848),i=a(28453),o=a(89487);const l={authors:"elliott",slug:"anim-layer-masks-and-blending",title:"Anim Layer Masks and Blending",tags:["animation","editor","workflow"]},s=void 0,c={authorsImageUrls:[void 0]},m=[{value:"Animating characters",id:"animating-characters",level:2},{value:"Anim Layer Masks",id:"anim-layer-masks",level:2},{value:"Anim Layer Blending",id:"anim-layer-blending",level:2},{value:"Useful Links",id:"useful-links",level:2}];function u(e){const n={a:"a",br:"br",code:"code",em:"em",h2:"h2",img:"img",li:"li",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.img,{src:a(88179).A+"",width:"909",height:"718"}),(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.em,{children:(0,r.jsx)(n.a,{href:"https://playcanvas.github.io/#/animation/layer-masks",children:"RUN DEMO"})})]}),"\n",(0,r.jsx)(n.p,{children:"Today, we are releasing the latest anim component feature: the masking and blending of anim layers."}),"\n",(0,r.jsx)(n.p,{children:"This is a versatile feature that has been hotly requested by PlayCanvas developers that wish to get even more creative with their animations. We\u2019re excited to be able to share how it works in this blog."}),"\n",(0,r.jsx)(n.h2,{id:"animating-characters",children:"Animating characters"}),"\n",(0,r.jsx)(n.p,{children:"When creating complex animation behavior for games, it is often necessary to make a character carry out multiple actions at once. For instance, you might want to create a character that can pick up and carry an item, or shoot a weapon while freely moving around a scene."}),"\n",(0,r.jsx)(n.p,{children:"To perform these actions at the same time, the upper and lower body of the character must be animated independently. The upper body should be able to move from an idle stance to a shooting stance, and then shoot on demand, all while the lower body moves between idling, walking, running based on the player's command."}),"\n",(0,r.jsx)(o.A,{width:"100%",height:"auto",playing:!0,controls:!0,src:"/img/anim-masked-locomotion.mp4"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"A character with two animation layers. A movement layer and a shooting layer masked to the upper body"})}),"\n",(0,r.jsx)(n.p,{children:"This effect can be difficult to achieve in most 3D engines, as it usually requires removing certain animated bones in the animation files themselves, before importing those assets into a game project. Only then would a developer be able to create two animation layers, one for movement and another for shooting."}),"\n",(0,r.jsx)(n.p,{children:"A shooting animation might have all of its lower body bones removed, which would free up the lower body to be animated by the movement layer. In large projects, this can start to become really cumbersome. Adding or removing bones from an animation would require a rebuild of the animation asset in whichever modelling software the developer is using, followed by a reimport of the asset into the PlayCanvas project."}),"\n",(0,r.jsx)(n.h2,{id:"anim-layer-masks",children:"Anim Layer Masks"}),"\n",(0,r.jsx)(n.p,{children:"Masks can streamline this workflow by enabling developers to add or remove a model\u2019s bones from an animation layer directly. This means you can select which part of a character a particular set of animations should animate directly in the PlayCanvas editor. Testing out different combinations of character bones now becomes as simple as toggling a few checkboxes."}),"\n",(0,r.jsx)(o.A,{width:"100%",height:"auto",playing:!0,controls:!0,src:"/img/anim-layer-masking.mp4"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Creating layer masks in the PlayCanvas editor"})}),"\n",(0,r.jsx)(n.p,{children:"By selecting only the bones in the upper body of the character model for an anim layer, you can free up the lower body to be animated by previous layers which would have been overwritten without this upper body mask."}),"\n",(0,r.jsx)(n.h2,{id:"anim-layer-blending",children:"Anim Layer Blending"}),"\n",(0,r.jsx)(n.p,{children:"Previously when using the anim component, you could play any number of animations on top of each other by creating multiple anim layers. However, any animations from subsequent layers that animate the same bones as previous ones will completely overwrite those previous animations."}),"\n",(0,r.jsx)(n.p,{children:"That meant that even if you were to add a shooting animation to the top half of a character, it would always be playing over a walking animation that was placed on a previous layer."}),"\n",(0,r.jsx)(n.p,{children:"Now with anim layer blending, it is possible to smoothly blend subsequent layers in and out, changing the weight each layer contributes to the characters animation in real time."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.img,{src:a(61563).A+"",width:"909",height:"717"}),(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.em,{children:"Animation layer blending in the PlayCanvas examples browser"})]}),"\n",(0,r.jsxs)(n.p,{children:["When editing an AnimStateGraph asset, you\u2019re now presented with two ",(0,r.jsx)(n.code,{children:"Blend Type"})," options in each layer. The ",(0,r.jsx)(n.code,{children:"Overwrite"})," option is set by default and works as before, each subsequent layer completely overwrites the animation values of previous layers."]}),"\n",(0,r.jsx)(n.p,{children:"However, now, if you select the \u2018Additive\u2019 option, the anim system will take the weight of each additive layer into account and blend the layered animations accordingly. This is a great way to blend one animation on top of another."}),"\n",(0,r.jsx)(n.h2,{id:"useful-links",children:"Useful Links"}),"\n",(0,r.jsx)(n.p,{children:"We\u2019re really keen to see what you can create in PlayCanvas using this feature, so be sure to check out the links below so you can begin working with layer masks and blending."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://developer.playcanvas.com/user-manual/animation/anim-layer-masking/",children:"Anim Layer Masks User Manual"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://developer.playcanvas.com/user-manual/animation/anim-state-graph-assets/#layer-blending",children:"Anim Layer Blending User Manual"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://playcanvas.github.io/#/animation/layer-masks",children:"Layer Masks Engine Example"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},61563:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/anim-layer-blending2-410f76335389d415bcb3f298f66210e0.gif"},88179:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/anim-layer-blending-e2e237916fd6dcdd7f28498402c6f7a4.gif"},89487:(e,n,a)=>{a.d(n,{A:()=>A});var t=a(96540);const r=/\.(m4a|m4b|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx)($|\?)/i,i=/\.(mp4|og[gv]|webm|mov|m4v)(#t=[,\d+]+)?($|\?)/i,o=/\.(m3u8)($|\?)/i,l=/\.(mpd)($|\?)/i,s=/stream\.mux\.com\/(?!\w+\.m3u8)(\w+)/,c=/(?:youtu\.be\/|youtube(?:-nocookie|education)?\.com\/(?:embed\/|v\/|watch\/|watch\?v=|watch\?.+&v=|shorts\/|live\/))((\w|-){11})|youtube\.com\/playlist\?list=|youtube\.com\/user\//,m=/vimeo\.com\/(?!progressive_redirect).+/,u=/(?:wistia\.(?:com|net)|wi\.st)\/(?:medias|embed)\/(?:iframe\/)?([^?]+)/,h=/open\.spotify\.com\/(\w+)\/(\w+)/i,d=/(?:www\.|go\.)?twitch\.tv\/([a-zA-Z0-9_]+|(videos?\/|\?video=)\d+)($|\?)/,y=(e,n)=>{if(Array.isArray(e)){for(const a of e){if("string"==typeof a&&y(a,n))return!0;if(y(a.src,n))return!0}return!1}return n(e)},p={html:e=>y(e,e=>r.test(e)||i.test(e)),hls:e=>y(e,e=>o.test(e)),dash:e=>y(e,e=>l.test(e)),mux:e=>s.test(e),youtube:e=>c.test(e),vimeo:e=>m.test(e)&&!i.test(e)&&!o.test(e),wistia:e=>u.test(e),spotify:e=>h.test(e),twitch:e=>d.test(e)};var b=t.forwardRef((e,n)=>{const a=r.test(`${e.src}`)?"audio":"video";return t.createElement(a,{...e,ref:n},e.children)});var f=[{key:"hls",name:"hls.js",canPlay:p.hls,canEnablePIP:()=>!0,player:(0,t.lazy)(()=>Promise.all([a.e(72606),a.e(32262)]).then(a.bind(a,31833)))},{key:"dash",name:"dash.js",canPlay:p.dash,canEnablePIP:()=>!0,player:(0,t.lazy)(()=>a.e(6395).then(a.bind(a,19380)))},{key:"mux",name:"Mux",canPlay:p.mux,canEnablePIP:()=>!0,player:(0,t.lazy)(()=>Promise.all([a.e(72606),a.e(52723)]).then(a.bind(a,31933)))},{key:"youtube",name:"YouTube",canPlay:p.youtube,player:(0,t.lazy)(()=>a.e(18446).then(a.bind(a,30126)))},{key:"vimeo",name:"Vimeo",canPlay:p.vimeo,player:(0,t.lazy)(()=>a.e(26173).then(a.bind(a,91682)))},{key:"wistia",name:"Wistia",canPlay:p.wistia,canEnablePIP:()=>!0,player:(0,t.lazy)(()=>a.e(99340).then(a.bind(a,89971)))},{key:"spotify",name:"Spotify",canPlay:p.spotify,canEnablePIP:()=>!1,player:(0,t.lazy)(()=>a.e(32771).then(a.bind(a,99422)))},{key:"twitch",name:"Twitch",canPlay:p.twitch,canEnablePIP:()=>!1,player:(0,t.lazy)(()=>a.e(12042).then(a.bind(a,45946)))},{key:"html",name:"html",canPlay:p.html,canEnablePIP:()=>!0,player:b}],g=a(14744);const w={width:"320px",height:"180px",volume:1,playbackRate:1,previewTabIndex:0,previewAriaLabel:"",oEmbedUrl:"https://noembed.com/embed?url={url}"},v=t.forwardRef((e,n)=>{const{playing:a,pip:r}=e,i=e.activePlayer,o=(0,t.useRef)(null),l=(0,t.useRef)(!0);(0,t.useEffect)(()=>{var n,t;o.current&&(o.current.paused&&!0===a&&o.current.play(),o.current.paused||!1!==a||o.current.pause(),o.current.playbackRate=null!=(n=e.playbackRate)?n:1,o.current.volume=null!=(t=e.volume)?t:1)}),(0,t.useEffect)(()=>{var e,n,a,t,i;if(o.current&&globalThis.document){if(r&&!document.pictureInPictureElement)try{null==(n=(e=o.current).requestPictureInPicture)||n.call(e)}catch(l){}if(!r&&document.pictureInPictureElement)try{null==(t=(a=o.current).exitPictureInPicture)||t.call(a),null==(i=document.exitPictureInPicture)||i.call(document)}catch(l){}}},[r]);if(!i)return null;const s={};for(const t in e)t.startsWith("on")&&(s[t]=e[t]);return t.createElement(i,{...s,style:e.style,className:e.className,slot:e.slot,ref:(0,t.useCallback)(e=>{o.current=e,"function"==typeof n?n(e):null!==n&&(n.current=e)},[n]),src:e.src,crossOrigin:e.crossOrigin,preload:e.preload,controls:e.controls,muted:e.muted,autoPlay:e.autoPlay,loop:e.loop,playsInline:e.playsInline,config:e.config,onLoadStart:n=>{var a,t;l.current=!0,null==(a=e.onReady)||a.call(e),null==(t=e.onLoadStart)||t.call(e,n)},onPlay:n=>{var a,t;l.current&&(l.current=!1,null==(a=e.onStart)||a.call(e,n)),null==(t=e.onPlay)||t.call(e,n)}},e.children)});v.displayName="Player";var k=v;const x=(0,t.lazy)(()=>a.e(36353).then(a.bind(a,21924))),P=[],j=({children:e})=>e;var A=((e,n)=>{const a=t.forwardRef(({children:a,...r},i)=>{const o=g(w,r),{src:l,slot:s,className:c,style:m,width:u,height:h,fallback:d,wrapper:y}=o,[p,b]=(0,t.useState)(!!o.light);(0,t.useEffect)(()=>{o.light?b(!0):b(!1)},[o.light]);const f=e=>{var n;b(!1),null==(n=o.onClickPreview)||n.call(o,e)},v=null==y?j:y,A=!1===d?j:t.Suspense;return t.createElement(v,{slot:s,className:c,style:{width:u,height:h,...m}},t.createElement(A,{fallback:d},p?(e=>{if(!e)return null;const{light:n,playIcon:a,previewTabIndex:r,oEmbedUrl:i,previewAriaLabel:l}=o;return t.createElement(x,{src:e,light:n,playIcon:a,previewTabIndex:r,previewAriaLabel:l,oEmbedUrl:i,onClickPreview:f})})(l):(r=>{var l,m;const u=(a=>{for(const n of[...P,...e])if(a&&n.canPlay(a))return n;return n||null})(r);if(!u)return null;const{style:h,width:d,height:y,wrapper:p}=o,b=null==(l=o.config)?void 0:l[u.key];return t.createElement(k,{...o,ref:i,activePlayer:null!=(m=u.player)?m:u,slot:p?void 0:s,className:p?void 0:c,style:p?{display:"block",width:"100%",height:"100%"}:{display:"block",width:d,height:y,...h},config:b},a)})(l)))});return a.displayName="ReactPlayer",a.addCustomPlayer=e=>{P.push(e)},a.removeCustomPlayers=()=>{P.length=0},a.canPlay=n=>{if(n)for(const a of[...P,...e])if(a.canPlay(n))return!0;return!1},a.canEnablePIP=n=>{var a;if(n)for(const t of[...P,...e])if(t.canPlay(n)&&(null==(a=t.canEnablePIP)?void 0:a.call(t)))return!0;return!1},a})(f,f[f.length-1])}}]);