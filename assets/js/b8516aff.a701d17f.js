"use strict";(self.webpackChunk_playcanvas_blog=self.webpackChunk_playcanvas_blog||[]).push([[28364],{1197:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/anim-blend-trees-3cb4dee62ef116a47a7e8159fbd808c1.gif"},14744:e=>{var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===a}(e)}(e)};var a="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function n(e,t){return!1!==t.clone&&t.isMergeableObject(e)?l((a=e,Array.isArray(a)?[]:{}),e,t):e;var a}function i(e,t,a){return e.concat(t).map(function(e){return n(e,a)})}function r(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return Object.propertyIsEnumerable.call(e,t)}):[]}(e))}function s(e,t){try{return t in e}catch(a){return!1}}function o(e,t,a){var i={};return a.isMergeableObject(e)&&r(e).forEach(function(t){i[t]=n(e[t],a)}),r(t).forEach(function(r){(function(e,t){return s(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,r)||(s(e,r)&&a.isMergeableObject(t[r])?i[r]=function(e,t){if(!t.customMerge)return l;var a=t.customMerge(e);return"function"==typeof a?a:l}(r,a)(e[r],t[r],a):i[r]=n(t[r],a))}),i}function l(e,a,r){(r=r||{}).arrayMerge=r.arrayMerge||i,r.isMergeableObject=r.isMergeableObject||t,r.cloneUnlessOtherwiseSpecified=n;var s=Array.isArray(a);return s===Array.isArray(e)?s?r.arrayMerge(e,a,r):o(e,a,r):n(a,r)}l.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,a){return l(e,a,t)},{})};var c=l;e.exports=c},22813:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>n,toc:()=>h});var n=a(27877),i=a(74848),r=a(28453),s=a(89487);const o={authors:"elliott",slug:"introducing-the-anim-state-graph",title:"Introducing the Anim State Graph",tags:["animation","editor","workflow"]},l=void 0,c={authorsImageUrls:[void 0]},h=[{value:"Features",id:"features",level:3},{value:"How does it all work?",id:"how-does-it-all-work",level:3},{value:"Looking Ahead",id:"looking-ahead",level:3}];function u(e){const t={a:"a",br:"br",em:"em",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"We\u2019re excited to be able to release a new system for creating fantastic and high fidelity animations in PlayCanvas!"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:a(42110).A+"",children:(0,i.jsx)(t.img,{src:a(27004).A+"",width:"1200",height:"501"})})}),"\n",(0,i.jsx)(t.p,{children:"Animation systems receive a set of inputs (button presses, current player speed, health, etc) and output a model's animation pose for the current frame. How an animation system goes from a particular set of inputs to the desired animation pose can become quite complicated, especially when writing this in code."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:a(37407).A+"",children:(0,i.jsx)(t.img,{alt:"Animation Input and Outputs",src:a(83057).A+"",width:"1318",height:"372"})})}),"\n",(0,i.jsx)(t.p,{children:"With the release of the Anim component, Anim State Graph assets and Anim State Graph Editor, you will be able to design and develop intricate animation behavior for your game objects right in the PlayCanvas editor."}),"\n",(0,i.jsx)(t.p,{children:"It\u2019s now easier than ever to make your game characters move just the way you\u2019d like, while writing minimal code in the process!"}),"\n",(0,i.jsxs)(t.p,{children:["Having recently beta tested this feature with a number of developers, we\u2019ve already seen some fantastic results! For instance, the developer of the popular online shooter ",(0,i.jsx)(t.a,{href:"https://venge.io/",children:"venge.io"})," is utilizing the anim state graph to drive character animations in their up and coming online RPG."]}),"\n",(0,i.jsx)(t.p,{children:"A clip of an early build of this game can be seen below, showcasing the blending of multiple animation clips. When combined together in a state graph they create realistic and fluid movement for the main character."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:a(46920).A+"",width:"541",height:"300"})}),"\n",(0,i.jsx)(t.p,{children:"This animation system was entirely developed in the PlayCanvas editor using the anim state graph user interface. The state graph for the main character can be seen below:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:a(87623).A+"",width:"1600",height:"1280"})}),"\n",(0,i.jsx)(t.p,{children:"We can\u2019t wait to see what other developers can create with this system!"}),"\n",(0,i.jsx)(t.h3,{id:"features",children:"Features"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Graph Layers"})," - Split your animation behavior into separate layers. For instance: locomotion animations can be separated from facial expressions."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Multiple characters"})," - Because anim state graphs are stored as assets, a single graph can be used to drive the animation of as many entities as you want by assigning your graph asset to multiple entity anim components."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.img,{src:a(47706).A+"",width:"437",height:"350"}),(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.em,{children:"Multiple characters utilizing the same anim state graph"})]}),"\n",(0,i.jsx)(t.p,{children:"While these two characters use different animations for their various actions, they share the same behavior. With the anim state graph you can update this behavior in one place while still using it with as many characters as you like."}),"\n",(0,i.jsx)(t.h3,{id:"how-does-it-all-work",children:"How does it all work?"}),"\n",(0,i.jsx)(t.p,{children:"When opening an Anim State Graph asset you\u2019ll be presented with a visual graph editor which allows you to define all of the different animation states your game object can be in. You can then connect these states using transitions."}),"\n",(0,i.jsx)(s.A,{width:"100%",height:"auto",playing:!0,controls:!0,src:"/img/anim-create-state-graph.mp4"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.em,{children:"Create anim state graphs using the editor UI"})}),"\n",(0,i.jsx)(t.p,{children:"Each transition blends between two animations over a specified amount of time. You can adjust and tweak transitions to your liking and see the results in real time in the PlayCanvas launch page. You can then assign parameter conditions to each transition to define the circumstances under which that transition can fire. These parameter values can be modified in your scripts to control the behavior of your animation system."}),"\n",(0,i.jsx)(s.A,{width:"100%",height:"auto",playing:!0,controls:!0,src:"/img/anim-script-trigger.mp4"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.em,{children:"Control anim state graph behavior in scripts using the anim component API"})}),"\n",(0,i.jsx)(t.p,{children:"Once you\u2019ve created your Anim State Graph you can assign it to your entity using the Anim component. At this point you can attach your animation assets to each state which will play when transitioning to that state."}),"\n",(0,i.jsx)(t.h3,{id:"looking-ahead",children:"Looking Ahead"}),"\n",(0,i.jsx)(t.p,{children:"Today only marks the initial release of our new animation system. We\u2019ve got grand plans on how to push the system further. Here\u2019s a few features we\u2019ve got in the works:"}),"\n",(0,i.jsx)(t.p,{children:"Animation Events - These events can be set up to fire and specific points during the lifetime of an animation, allowing you to hook game logic into the behavior of your anim state graph. For example you could spawn a set of dust particles during the exact frame that your character lands on the ground after a jump."}),"\n",(0,i.jsx)(t.p,{children:"Layer Masking - You\u2019ll be able mask your character animations on a particular state graph layer. For instance you could have only the bottom half of a character driven by a particular anim state graph layer."}),"\n",(0,i.jsx)(t.p,{children:"Blend Trees - Directly control the blend between multiple animations in real time."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.img,{src:a(1197).A+"",width:"720",height:"720"}),(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.em,{children:"Blending three animations using a 2D cartesian blend tree"})]}),"\n",(0,i.jsx)(t.p,{children:"Animation Clips - Currently the anim state graph supports animation assets that have been imported into PlayCanvas. Clips will allow you to create extra animation assets within the PlayCanvas editor yourself! These will be great for quickly adding smaller animated flourishes to your game objects."}),"\n",(0,i.jsx)(t.p,{children:"If you\u2019re interested in using anim state graphs in your PlayCanvas projects, here\u2019s some useful links:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://developer.playcanvas.com/user-manual/animation/",children:"User Manual"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://developer.playcanvas.com/tutorials/anim-blending/",children:"Animation Blending Tutorial"})}),"\n"]})]})}function m(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},27004:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/animation-and-graph-2-53f04b3e4de1cece5835bc9e62316846.gif"},27877:e=>{e.exports=JSON.parse('{"permalink":"/introducing-the-anim-state-graph","editUrl":"https://github.com/playcanvas/blog/tree/main/blog/2021-05-05-introducing-the-anim-state-graph.md","source":"@site/blog/2021-05-05-introducing-the-anim-state-graph.md","title":"Introducing the Anim State Graph","description":"We\u2019re excited to be able to release a new system for creating fantastic and high fidelity animations in PlayCanvas!","date":"2021-05-05T00:00:00.000Z","tags":[{"inline":true,"label":"animation","permalink":"/tags/animation"},{"inline":true,"label":"editor","permalink":"/tags/editor"},{"inline":true,"label":"workflow","permalink":"/tags/workflow"}],"readingTime":4.12,"hasTruncateMarker":true,"authors":[{"name":"Elliott Thompson","title":"Software Engineer","page":{"permalink":"/authors/elliott"},"socials":{"x":"https://x.com/elliott_thomps","linkedin":"https://www.linkedin.com/in/ellt92/","github":"https://github.com/ellthompson"},"imageURL":"https://github.com/ellthompson.png","key":"elliott"}],"frontMatter":{"authors":"elliott","slug":"introducing-the-anim-state-graph","title":"Introducing the Anim State Graph","tags":["animation","editor","workflow"]},"unlisted":false,"prevItem":{"title":"Transitioning to the New Render Component and Fill Mode API","permalink":"/transitioning-to-the-new-render-component-and-fill-mode-api"},"nextItem":{"title":"Build Facebook Playable Ads with PlayCanvas!","permalink":"/build-facebook-playable-ads-with-playcanvas"}}')},28453:(e,t,a)=>{a.d(t,{R:()=>s,x:()=>o});var n=a(96540);const i={},r=n.createContext(i);function s(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(r.Provider,{value:t},e.children)}},37407:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/files/anim-inputs-and-outputs-11f7d752db22ef495027ad561275bec6.png"},42110:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/files/animation-and-graph-2-53f04b3e4de1cece5835bc9e62316846.gif"},46920:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/cem-prototype-3ec97a95396cdf728f5765642c2a1a85.gif"},47706:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/anim-state-graph-shared-b06e01c9eaa18b6bc6078650525aa4c6.gif"},83057:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/anim-inputs-and-outputs-11f7d752db22ef495027ad561275bec6.png"},87623:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/anim-state-graph-498b1b20b41d981ef105d60d85a825d0.png"},89487:(e,t,a)=>{a.d(t,{A:()=>A});var n=a(96540);const i=/\.(m4a|m4b|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx)($|\?)/i,r=/\.(mp4|og[gv]|webm|mov|m4v)(#t=[,\d+]+)?($|\?)/i,s=/\.(m3u8)($|\?)/i,o=/\.(mpd)($|\?)/i,l=/stream\.mux\.com\/(?!\w+\.m3u8)(\w+)/,c=/(?:youtu\.be\/|youtube(?:-nocookie|education)?\.com\/(?:embed\/|v\/|watch\/|watch\?v=|watch\?.+&v=|shorts\/|live\/))((\w|-){11})|youtube\.com\/playlist\?list=|youtube\.com\/user\//,h=/vimeo\.com\/(?!progressive_redirect).+/,u=/(?:wistia\.(?:com|net)|wi\.st)\/(?:medias|embed)\/(?:iframe\/)?([^?]+)/,m=/open\.spotify\.com\/(\w+)\/(\w+)/i,d=/(?:www\.|go\.)?twitch\.tv\/([a-zA-Z0-9_]+|(videos?\/|\?video=)\d+)($|\?)/,p=(e,t)=>{if(Array.isArray(e)){for(const a of e){if("string"==typeof a&&p(a,t))return!0;if(p(a.src,t))return!0}return!1}return t(e)},y={html:e=>p(e,e=>i.test(e)||r.test(e)),hls:e=>p(e,e=>s.test(e)),dash:e=>p(e,e=>o.test(e)),mux:e=>l.test(e),youtube:e=>c.test(e),vimeo:e=>h.test(e)&&!r.test(e)&&!s.test(e),wistia:e=>u.test(e),spotify:e=>m.test(e),twitch:e=>d.test(e)};var g=n.forwardRef((e,t)=>{const a=i.test(`${e.src}`)?"audio":"video";return n.createElement(a,{...e,ref:t},e.children)});var f=[{key:"hls",name:"hls.js",canPlay:y.hls,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>Promise.all([a.e(72606),a.e(32262)]).then(a.bind(a,31833)))},{key:"dash",name:"dash.js",canPlay:y.dash,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>a.e(6395).then(a.bind(a,19380)))},{key:"mux",name:"Mux",canPlay:y.mux,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>Promise.all([a.e(72606),a.e(52723)]).then(a.bind(a,31933)))},{key:"youtube",name:"YouTube",canPlay:y.youtube,player:(0,n.lazy)(()=>a.e(18446).then(a.bind(a,30126)))},{key:"vimeo",name:"Vimeo",canPlay:y.vimeo,player:(0,n.lazy)(()=>a.e(26173).then(a.bind(a,91682)))},{key:"wistia",name:"Wistia",canPlay:y.wistia,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>a.e(99340).then(a.bind(a,89971)))},{key:"spotify",name:"Spotify",canPlay:y.spotify,canEnablePIP:()=>!1,player:(0,n.lazy)(()=>a.e(32771).then(a.bind(a,99422)))},{key:"twitch",name:"Twitch",canPlay:y.twitch,canEnablePIP:()=>!1,player:(0,n.lazy)(()=>a.e(12042).then(a.bind(a,45946)))},{key:"html",name:"html",canPlay:y.html,canEnablePIP:()=>!0,player:g}],b=a(14744);const w={width:"320px",height:"180px",volume:1,playbackRate:1,previewTabIndex:0,previewAriaLabel:"",oEmbedUrl:"https://noembed.com/embed?url={url}"},v=n.forwardRef((e,t)=>{const{playing:a,pip:i}=e,r=e.activePlayer,s=(0,n.useRef)(null),o=(0,n.useRef)(!0);(0,n.useEffect)(()=>{var t,n;s.current&&(s.current.paused&&!0===a&&s.current.play(),s.current.paused||!1!==a||s.current.pause(),s.current.playbackRate=null!=(t=e.playbackRate)?t:1,s.current.volume=null!=(n=e.volume)?n:1)}),(0,n.useEffect)(()=>{var e,t,a,n,r;if(s.current&&globalThis.document){if(i&&!document.pictureInPictureElement)try{null==(t=(e=s.current).requestPictureInPicture)||t.call(e)}catch(o){}if(!i&&document.pictureInPictureElement)try{null==(n=(a=s.current).exitPictureInPicture)||n.call(a),null==(r=document.exitPictureInPicture)||r.call(document)}catch(o){}}},[i]);if(!r)return null;const l={};for(const n in e)n.startsWith("on")&&(l[n]=e[n]);return n.createElement(r,{...l,style:e.style,className:e.className,slot:e.slot,ref:(0,n.useCallback)(e=>{s.current=e,"function"==typeof t?t(e):null!==t&&(t.current=e)},[t]),src:e.src,crossOrigin:e.crossOrigin,preload:e.preload,controls:e.controls,muted:e.muted,autoPlay:e.autoPlay,loop:e.loop,playsInline:e.playsInline,config:e.config,onLoadStart:t=>{var a,n;o.current=!0,null==(a=e.onReady)||a.call(e),null==(n=e.onLoadStart)||n.call(e,t)},onPlay:t=>{var a,n;o.current&&(o.current=!1,null==(a=e.onStart)||a.call(e,t)),null==(n=e.onPlay)||n.call(e,t)}},e.children)});v.displayName="Player";var x=v;const j=(0,n.lazy)(()=>a.e(36353).then(a.bind(a,21924))),k=[],P=({children:e})=>e;var A=((e,t)=>{const a=n.forwardRef(({children:a,...i},r)=>{const s=b(w,i),{src:o,slot:l,className:c,style:h,width:u,height:m,fallback:d,wrapper:p}=s,[y,g]=(0,n.useState)(!!s.light);(0,n.useEffect)(()=>{s.light?g(!0):g(!1)},[s.light]);const f=e=>{var t;g(!1),null==(t=s.onClickPreview)||t.call(s,e)},v=null==p?P:p,A=!1===d?P:n.Suspense;return n.createElement(v,{slot:l,className:c,style:{width:u,height:m,...h}},n.createElement(A,{fallback:d},y?(e=>{if(!e)return null;const{light:t,playIcon:a,previewTabIndex:i,oEmbedUrl:r,previewAriaLabel:o}=s;return n.createElement(j,{src:e,light:t,playIcon:a,previewTabIndex:i,previewAriaLabel:o,oEmbedUrl:r,onClickPreview:f})})(o):(i=>{var o,h;const u=(a=>{for(const t of[...k,...e])if(a&&t.canPlay(a))return t;return t||null})(i);if(!u)return null;const{style:m,width:d,height:p,wrapper:y}=s,g=null==(o=s.config)?void 0:o[u.key];return n.createElement(x,{...s,ref:r,activePlayer:null!=(h=u.player)?h:u,slot:y?void 0:l,className:y?void 0:c,style:y?{display:"block",width:"100%",height:"100%"}:{display:"block",width:d,height:p,...m},config:g},a)})(o)))});return a.displayName="ReactPlayer",a.addCustomPlayer=e=>{k.push(e)},a.removeCustomPlayers=()=>{k.length=0},a.canPlay=t=>{if(t)for(const a of[...k,...e])if(a.canPlay(t))return!0;return!1},a.canEnablePIP=t=>{var a;if(t)for(const n of[...k,...e])if(n.canPlay(t)&&(null==(a=n.canEnablePIP)?void 0:a.call(n)))return!0;return!1},a})(f,f[f.length-1])}}]);