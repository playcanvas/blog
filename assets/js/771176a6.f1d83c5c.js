"use strict";(self.webpackChunk_playcanvas_blog=self.webpackChunk_playcanvas_blog||[]).push([[51373],{9328:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var a=t(74848),n=t(28453);const r={authors:"will",slug:"webgl-case-study-rebuilding-the-star-lord-pbr-demo",title:"WebGL Case Study: Rebuilding the Star-Lord PBR Demo",tags:["graphics","performance"]},i=void 0,l={permalink:"/webgl-case-study-rebuilding-the-star-lord-pbr-demo",editUrl:"https://github.com/playcanvas/blog/tree/main/blog/2021-02-11-webgl-case-study-rebuilding-the-star-lord-pbr-demo.md",source:"@site/blog/2021-02-11-webgl-case-study-rebuilding-the-star-lord-pbr-demo.md",title:"WebGL Case Study: Rebuilding the Star-Lord PBR Demo",description:"Way back in 2014, PlayCanvas was the first WebGL Engine to integrate PBR (Physically Based Rendering). To mark the event, we built the Star-Lord tech demo:",date:"2021-02-11T00:00:00.000Z",tags:[{inline:!0,label:"graphics",permalink:"/tags/graphics"},{inline:!0,label:"performance",permalink:"/tags/performance"}],readingTime:3.45,hasTruncateMarker:!0,authors:[{name:"Will Eastcott",title:"CEO",description:"Will Eastcott is an entrepreneur and veteran technologist of the games industry with experience at EA, Sony, and Activision. He has been credited in many AAA game franchises such as GTA, Call of Duty and Max Payne. He is best known for co-founding PlayCanvas, the web graphics creation platform. As CEO, he has championed the company's mission to make graphical web app development more accessible and collaborative through open-source technologies and cloud-based tools.",page:{permalink:"/authors/will"},socials:{x:"https://x.com/willeastcott",linkedin:"https://www.linkedin.com/in/willeastcott/",github:"https://github.com/willeastcott"},imageURL:"https://media.licdn.com/dms/image/v2/D4D03AQF9YXIeHZW9kg/profile-displayphoto-shrink_800_800/profile-displayphoto-shrink_800_800/0/1688995668268?e=1730332800&v=beta&t=UmAwlJ0nPBmnMczQ4wknx1jSDJ2anqurm2b15iLm3pM",key:"will"}],frontMatter:{authors:"will",slug:"webgl-case-study-rebuilding-the-star-lord-pbr-demo",title:"WebGL Case Study: Rebuilding the Star-Lord PBR Demo",tags:["graphics","performance"]},unlisted:!1,prevItem:{title:"Build Facebook Playable Ads with PlayCanvas!",permalink:"/build-facebook-playable-ads-with-playcanvas"},nextItem:{title:"Basis Texture Compression arrives in PlayCanvas",permalink:"/basis-texture-compression-arrives-in-playcanvas"}},o={authorsImageUrls:[void 0]},d=[{value:"Convert JSON Meshes to GLB",id:"convert-json-meshes-to-glb",level:3},{value:"Basis Compress Textures",id:"basis-compress-textures",level:3},{value:"Prefilter Cubemaps in the Editor",id:"prefilter-cubemaps-in-the-editor",level:3},{value:"Asynchronously Load Assets",id:"asynchronously-load-assets",level:3},{value:"Useful Links",id:"useful-links",level:3}];function c(e){const s={a:"a",em:"em",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(s.p,{children:["Way back in 2014, ",(0,a.jsx)(s.a,{href:"https://blog.playcanvas.com/physically-based-rendering-comes-to-webgl/",children:"PlayCanvas was the first WebGL Engine to integrate PBR"})," (Physically Based Rendering). To mark the event, we built the Star-Lord tech demo:"]}),"\n",(0,a.jsx)("div",{className:"iframe-container",children:(0,a.jsx)("iframe",{loading:"lazy",src:"https://playcanv.as/p/SA7hVBLt/",title:"360 lookaround camera",webkitallowfullscreen:"true",mozallowfullscreen:"true",allow:"autoplay",allowfullscreen:"true",allowvr:"",scrolling:"no",frameborder:"0"})}),"\n",(0,a.jsx)(s.p,{children:"In the intervening 6 or so years, PlayCanvas has moved on dramatically. So we decided to leverage all of the latest engine features and republish it."}),"\n",(0,a.jsx)(s.p,{children:"The most significant improvements are related to load time. Let's start out by comparing some key stats:"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{}),(0,a.jsx)(s.th,{children:(0,a.jsx)(s.a,{href:"https://playcanv.as/b/dCdIuibG/",children:"Star-Lord 2014"})}),(0,a.jsx)(s.th,{children:(0,a.jsx)(s.a,{href:"https://playcanv.as/p/SA7hVBLt/",children:"Star-Lord 2021"})}),(0,a.jsx)(s.th,{children:"% Change"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"HTTP Requests"}),(0,a.jsx)(s.td,{children:"220"}),(0,a.jsx)(s.td,{children:"39"}),(0,a.jsx)(s.td,{children:"\u2193 82.3%"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Preload Transfer (MB)"}),(0,a.jsx)(s.td,{children:"10.1"}),(0,a.jsx)(s.td,{children:"5.6"}),(0,a.jsx)(s.td,{children:"\u2193 44.6%"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Total Transfer (MB)"}),(0,a.jsx)(s.td,{children:"13.7"}),(0,a.jsx)(s.td,{children:"9.9"}),(0,a.jsx)(s.td,{children:"\u2193 27.7%"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Total Resources (MB)"}),(0,a.jsx)(s.td,{children:"26.0"}),(0,a.jsx)(s.td,{children:"12.1"}),(0,a.jsx)(s.td,{children:"\u2193 53.5%"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Load Time (s) *"}),(0,a.jsx)(s.td,{children:"1.8"}),(0,a.jsx)(s.td,{children:"1.2"}),(0,a.jsx)(s.td,{children:"\u2193 33.3%"})]})]})]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.em,{children:"* Cache disabled on 100Gbps connection"})}),"\n",(0,a.jsxs)(s.p,{children:["Those are some pretty ",(0,a.jsx)(s.strong,{children:(0,a.jsx)(s.em,{children:"significant wins"})}),"! So what are the differences between the two builds of the demo? Let's step through them one by one."]}),"\n",(0,a.jsx)(s.h3,{id:"convert-json-meshes-to-glb",children:"Convert JSON Meshes to GLB"}),"\n",(0,a.jsxs)(s.p,{children:["In October 2020, ",(0,a.jsx)(s.a,{href:"https://blog.playcanvas.com/faster-load-times-with-gltfs-glb-format/",children:"PlayCanvas officially switched"})," from JSON to glTF 2.0 (GLB) for storing all model and animation data. While gzipped GLB is reasonably similar in size to gzipped JSON, it is up to an order of magnitude faster to parse a GLB file once it has been downloaded. Plus, a GLB file occupies less system memory than the equivalent JSON file. Converting all of the assets from JSON to GLB is a simple process. First, flip the project setting 'Convert to GLB' in the 'Asset Tasks' group to true:"]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Convert to GLB",src:t(45580).A+"",width:"922",height:"854"})}),"\n",(0,a.jsx)(s.p,{children:"Now, simply reupload all FBX files and a .glb asset will be generated rather than a .json asset. The last step is to use the Replace command in the right-click context menu to replace the .json asset with the .glb asset (plus any materials as well)."}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Switch from JSON to GLB",src:t(38714).A+"",width:"1089",height:"425"})}),"\n",(0,a.jsx)(s.p,{children:"You can then delete the old JSON asset (plus any unreferenced related materials)."}),"\n",(0,a.jsx)(s.h3,{id:"basis-compress-textures",children:"Basis Compress Textures"}),"\n",(0,a.jsxs)(s.p,{children:["Last month, ",(0,a.jsx)(s.a,{href:"https://blog.playcanvas.com/basis-texture-compression-arrives-in-playcanvas/",children:"we announced"})," the integration of Basis texture compression into the Editor. Star-Lord was originally configured to use DXT, PVR and ETC compressed textures. A download size comparison is as follows:"]}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Texture Format"}),(0,a.jsx)(s.th,{children:"Download Size (MB)"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"DXT"}),(0,a.jsx)(s.td,{children:"7.56"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"PVR"}),(0,a.jsx)(s.td,{children:"6.09"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"ETC1"}),(0,a.jsx)(s.td,{children:"7.18"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Basis"}),(0,a.jsx)(s.td,{children:"2.38"})]})]})]}),"\n",(0,a.jsx)(s.p,{children:"This explains much of the download savings in the updated version."}),"\n",(0,a.jsx)(s.p,{children:"Fortunately, applying Basis compression to the app's textures is literally a two-click operation:"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(21187).A+"",children:(0,a.jsx)(s.img,{alt:"Compress Basis",src:t(56965).A+"",width:"1446",height:"474"})})}),"\n",(0,a.jsx)(s.h3,{id:"prefilter-cubemaps-in-the-editor",children:"Prefilter Cubemaps in the Editor"}),"\n",(0,a.jsx)(s.p,{children:"When PBR first arrived in PlayCanvas, the Editor could not prefilter cubemaps. This conversion had to be performed externally with RGBM format cubemap faces being added to the Editor:"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(64830).A+"",children:(0,a.jsx)(s.img,{alt:"Cubemap Faces",src:t(24808).A+"",width:"1601",height:"839"})})}),"\n",(0,a.jsx)(s.p,{children:"Each cubemap had 6 mip levels with 6 faces for each level. And with 5 different cubemaps, that meant 180 of the demo's 220 HTTP requests were for these PNGs!"}),"\n",(0,a.jsx)(s.p,{children:"These days, the Editor makes is super easy to import 6 HDR cubemap faces, build a cubemap and then prefilter it."}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(44759).A+"",children:(0,a.jsx)(s.img,{alt:"Prefilter Cubemap",src:t(79201).A+"",width:"1904",height:"1154"})})}),"\n",(0,a.jsx)(s.p,{children:"So instead of loading 180 PNGs, the demo now loads just 5 DDS files. Much faster. \ud83d\ude80"}),"\n",(0,a.jsx)(s.h3,{id:"asynchronously-load-assets",children:"Asynchronously Load Assets"}),"\n",(0,a.jsx)(s.p,{children:"To achieve an optimal load time, it is important to only load what is required to make your app functional. It is arguable that music is not strictly a necessary precondition for your app to start. Therefore, the demo now asynchronously loads the mp3 asset that contains the music track and auto-plays it as soon as it is downloaded. It is 3.9MB which accounts for nearly 40% of the app's payload! So be sure to carefully audit your app for assets that can be streamed instead of preloaded."}),"\n",(0,a.jsxs)(s.p,{children:["Read more about preloading and streaming of assets in the ",(0,a.jsx)(s.a,{href:"https://developer.playcanvas.com/user-manual/assets/preloading-and-streaming/",children:"User Manual"}),"."]}),"\n",(0,a.jsx)(s.h3,{id:"useful-links",children:"Useful Links"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://playcanvas.com/project/333626/overview/starlord",children:"Star-Lord Project"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://playcanv.as/p/SA7hVBLt/",children:"Star-Lord App"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://developer.playcanvas.com/user-manual/optimization/load-time/",children:"User Manual: Optimizing Load Time"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://developer.playcanvas.com/user-manual/graphics/physical-rendering/",children:"User Manual: Physically Based Rendering"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},21187:(e,s,t)=>{t.d(s,{A:()=>a});const a=t.p+"assets/files/editor-compress-basis-a34f7cedbb509c4aa2bf0d3bdb3f2fcf.gif"},44759:(e,s,t)=>{t.d(s,{A:()=>a});const a=t.p+"assets/files/editor-prefilter-cubemap-db2d7fabb5b99cdb6eaaae1dffeda2a4.gif"},64830:(e,s,t)=>{t.d(s,{A:()=>a});const a=t.p+"assets/files/prefiltered-cubemap-faces-d3a0cc3abdc6fe9bbca32a8064f593ea.png"},56965:(e,s,t)=>{t.d(s,{A:()=>a});const a=t.p+"assets/images/editor-compress-basis-a34f7cedbb509c4aa2bf0d3bdb3f2fcf.gif"},45580:(e,s,t)=>{t.d(s,{A:()=>a});const a=t.p+"assets/images/editor-convert-to-glb-3053cf0bf9ef92acd9056dd3672e5b98.png"},38714:(e,s,t)=>{t.d(s,{A:()=>a});const a=t.p+"assets/images/editor-json-to-glb-fa9e55850e15443052d65160014af7e2.gif"},79201:(e,s,t)=>{t.d(s,{A:()=>a});const a=t.p+"assets/images/editor-prefilter-cubemap-db2d7fabb5b99cdb6eaaae1dffeda2a4.gif"},24808:(e,s,t)=>{t.d(s,{A:()=>a});const a=t.p+"assets/images/prefiltered-cubemap-faces-d3a0cc3abdc6fe9bbca32a8064f593ea.png"},28453:(e,s,t)=>{t.d(s,{R:()=>i,x:()=>l});var a=t(96540);const n={},r=a.createContext(n);function i(e){const s=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),a.createElement(r.Provider,{value:s},e.children)}}}]);